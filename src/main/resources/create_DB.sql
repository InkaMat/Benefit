CREATE TABLE ACCOUNT (
ID BIGINT PRIMARY KEY,
LEVEL_OF_ACCESS VARCHAR(62),
ACTIVE SMALLINT DEFAULT 0  NOT NULL, 
ANSWER VARCHAR(255) NOT NULL, 
AUTHORIZED SMALLINT DEFAULT 0  NOT NULL, 
CREATION_DATE TIMESTAMP NOT NULL, 
LOGIN VARCHAR(255) NOT NULL, CONSTRAINT UNIQUE_LOGIN UNIQUE (LOGIN),
MODIFICATION_DATE TIMESTAMP, 
"NAME" VARCHAR(255) NOT NULL, 
PASSWORD VARCHAR(255) NOT NULL, 
PHONE VARCHAR(255) NOT NULL, 
QUESTION VARCHAR(255) NOT NULL,
SURNAME VARCHAR(255) NOT NULL, 
VERSION INTEGER NOT NULL, 
AUTHORIZED_BY BIGINT REFERENCES ACCOUNT(ID), 
MODIFICATED_BY BIGINT REFERENCES ACCOUNT(ID));

CREATE TABLE REWARDS (
ID BIGINT NOT NULL PRIMARY KEY,
ACTIVE SMALLINT DEFAULT 0  NOT NULL,
ACTIVITY_TYPE VARCHAR(255) NOT NULL,
CREATION_DATE TIMESTAMP NOT NULL,
FREQUENCY_OF_USE VARCHAR(255) NOT NULL,
MODIFICATION_DATE TIMESTAMP,
PRICE DECIMAL(8, 2) NOT NULL,
REWARD_NAME VARCHAR(255) NOT NULL, 
VERSION INTEGER NOT NULL,
CREATED_BY BIGINT NOT NULL REFERENCES ACCOUNT(ID),
MODIFICATED_BY BIGINT REFERENCES ACCOUNT(ID),
CONSTRAINT UNIQUE_REW_NAME UNIQUE (REWARD_NAME),
CONSTRAINT UNIUNIQUE_R_TYPE_FREQ UNIQUE (ACTIVITY_TYPE, FREQUENCY_OF_USE));

CREATE TABLE ORDERS (
ID BIGINT PRIMARY KEY,
CREATION_DATE TIMESTAMP NOT NULL,
MODIFICATION_DATE TIMESTAMP,
ORDER_MONTH DATE NOT NULL,
VERSION INTEGER NOT NULL,
ORDERED_BY BIGINT NOT NULL REFERENCES ACCOUNT(ID),
ORDERED_REWARD BIGINT REFERENCES ACCOUNT(ID),
CONSTRAINT UNIQUE_EMPL_MONTH UNIQUE (ORDERED_BY, ORDER_MONTH));

CREATE VIEW AUTH_TABLE AS 
SELECT LOGIN, PASSWORD, LEVEL_OF_ACCESS FROM ACCOUNT WHERE active>0 AND authorized>0 AND NOT level_of_access  = 'access.level.newaccount';  

